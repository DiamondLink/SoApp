<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion des Tickets</title>
  <!-- Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">


  <!-- Custom CSS -->
  <style>
    .ticket-list-item {
      cursor: pointer;
    }
    .ticket-details {
      display: none;
    }
    .piece-info {
    border: 1px solid black;
    border-radius: 10px;
    padding: 10px;
    margin: 10px;
}

  </style>
</head>
<body>
  <div class="container">
    <h1 class="my-4">Gestion des Tickets</h1>
    
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" href="#">Tous les Tickets</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Catégorie 1</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Catégorie 2</a>
      </li>
    </ul>

    <div class="list-group my-4">
      <!-- Un ticket -->
      <div class="list-group-item ticket-list-item">
        {% for ticket in tickets %}

<div class="card mb-1">
  <div class="card-header" id="heading{{ ticket.id }}" data-toggle="collapse" data-target="#collapse{{ ticket.id }}" aria-expanded="false" aria-controls="collapse{{ ticket.id }}" style="cursor: pointer;">
    <h5 class="mb-0">Ticket #{{ ticket.id }}: {% for piece in ticket.pieces %}<span class="badge" style="background-color: {{ piece.category.color }};">{{ piece.libelle }}</span>&nbsp;{% endfor %}</h5>
    <p class="mb-1">Téléphone: {{ ticket.user.tel }} | Statut: {{ ticket.status }} | Date: 2023-06-28 14:45</p>
  </div>

  <div id="collapse{{ ticket.id }}" class="collapse" aria-labelledby="heading{{ ticket.id }}" data-parent="#accordion">
    <div class="card-body">
      <p>Prenom: {{ticket.user.prenom}} | Nom: {{ticket.user.prenom}} | Type de client: {{ticket.user.prenom}} </p>
      {% for piece in ticket.pieces %}
      <hr>
      <span class="badge" style="color: black; border: 1px solid {{ piece.category.color }}; font-size: 1em;">{{ piece.libelle }}</span>
      <br><br>
      <span class="badge" style="color: black; border: 1px solid black; font-size: 1em; font-weight: 400;"> <strong>Immatriculation:</strong> <span class="immat_{{ piece.id }}">{{piece.immat}}</span></span>&nbsp;
      <span class="badge" style="color: black; border: 1px solid black; font-size: 1em; font-weight: 400;"> <strong>Marque:</strong> <span class="marque_{{ piece.id }}">{{piece.marque}}</span></span>&nbsp;
      <span class="badge" style="color: black; border: 1px solid black; font-size: 1em; font-weight: 400;"> <strong>Modèle:</strong> <span class="modele_{{ piece.id }}">{{piece.modele}}</span></span>&nbsp;
      <span class="badge" style="color: black; border: 1px solid black; font-size: 1em; font-weight: 400;"> <strong>Numéro de fabricant/Moteur::</strong> <span class="num_{{ piece.id }}">{{piece.numero}}</span></span>&nbsp;
      <span class="badge" style="color: black; border: 1px solid black; font-size: 1em; font-weight: 400;"> <strong>Prix:</strong> <span class="prix_{{ piece.id }}">{{piece.prix}}</span></span>&nbsp;

      <button type="button" class="btn btn-success" onclick="editPiece(this)" id="{{piece.id}}">
        Edit
      </button><br><br>
      
      
      <select class="form-control">
        <option selected>Ouvert</option>
        <option>En cours</option>
        <option>Fermé</option>
      </select>
      {% endfor %}
    </div>
  </div>
</div>
{% endfor %}

      <!-- Ajoutez d'autres tickets comme celui-ci -->
    </div>
  </div>

  <!-- Bootstrap JS & jQuery -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

<script>

function editPiece(btn) {
  var p = btn.parentElement.querySelector(`.immat_${btn.id}`);
  var p2 = btn.parentElement.querySelector(`.marque_${btn.id}`);
  var p3 = btn.parentElement.querySelector(`.modele_${btn.id}`);
  var p4 = btn.parentElement.querySelector(`.num_${btn.id}`);
  var p5 = btn.parentElement.querySelector(`.prix_${btn.id}`);

  // Create a new input element
  var input = document.createElement("input");
  var input2 = document.createElement("input");
  var input3 = document.createElement("input");
  var input4 = document.createElement("input");
  var input5 = document.createElement("input");

  input.className = `immat_${btn.id}`;
  input2.className = `marque_${btn.id}`;
  input3.className = `modele_${btn.id}`;
  input4.className = `num_${btn.id}`;
  input5.className = `prix_${btn.id}`;

  
  // Set the value of the input to the content of the paragraph
  input.value = p.textContent;
  input2.value = p2.textContent;
  input3.value = p3.textContent;
  input4.value = p4.textContent;
  input5.value = p5.textContent;
  
  // Replace the paragraph with the input
  p.parentNode.replaceChild(input, p);
  p2.parentNode.replaceChild(input2, p2);
  p3.parentNode.replaceChild(input3, p3);
  p4.parentNode.replaceChild(input4, p4);
  p5.parentNode.replaceChild(input5, p5);


  btn.textContent = "Save";
  btn.onclick = function() {
  savePiece(this);
  }
};






function savePiece(btn) {
  btn.textContent = "Edit";
  btn.onclick = function() {
  editPiece(this);
  }

  var p = btn.parentElement.querySelector(`.immat_${btn.id}`);
  var p2 = btn.parentElement.querySelector(`.marque_${btn.id}`);
  var p3 = btn.parentElement.querySelector(`.modele_${btn.id}`);
  var p4 = btn.parentElement.querySelector(`.num_${btn.id}`);
  var p5 = btn.parentElement.querySelector(`.prix_${btn.id}`);



var dict= {
		"immat" : p.value,
		"marque" : p2.value,
		"modele" : p3.value,
		"num" : p4.value,
		"prix" : p5.value
	}

	var json = JSON.stringify(dict);


  var span = document.createElement("span");
  var span2 = document.createElement("span");
  var span3 = document.createElement("span");
  var span4 = document.createElement("span");
  var span5 = document.createElement("span");


  span.className = `immat_${btn.id}`;
  span2.className = `marque_${btn.id}`;
  span3.className = `modele_${btn.id}`;
  span4.className = `num_${btn.id}`;
  span5.className = `prix_${btn.id}`;

  span.textContent = p.value;
  span2.textContent = p2.value;
  span3.textContent = p3.value;
  span4.textContent = p4.value;
  span5.textContent = p5.value;

  p.parentNode.replaceChild(span, p);
  p2.parentNode.replaceChild(span2, p2);
  p3.parentNode.replaceChild(span3, p3);
  p4.parentNode.replaceChild(span4, p4);
  p5.parentNode.replaceChild(span5, p5);


	fetch('/get_data_editing', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: json
    }).then(response => {
        if (!response.ok) {
            throw new Error("HTTP error " + response.status);
        }
        return response.json();
    }).then(json => {
        // Handle the JSON response here
    }).catch(function() {
        // Handle the error here
    });

  }


</script>

</body>
</html>
